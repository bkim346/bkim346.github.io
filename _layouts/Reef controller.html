<!DOCTYPE html>
<html lang="{{ site.lang }}">

<!-- Head -->
<head>
  {%- if page.redirect -%}
  <meta http-equiv="refresh" content="3; url={{ site.baseurl }}/" />
  {%- endif -%}
  {% include head.html %}
  <title>Reef Live Data</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@{{ site.bootstrap.version }}/dist/js/bootstrap.bundle.min.js" integrity="{{ site.bootstrap.integrity.js }}" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@{{ site.mdb.version }}/js/mdb.min.js" integrity="{{ site.mdb.integrity.js }}" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4"></script>
</head>

<!-- Body -->
<body class="{% if site.navbar_fixed %}fixed-top-nav{% endif %} {% unless site.footer_fixed %}sticky-bottom-footer{% endunless %}">
  <!-- Header -->
  {%- include header.html %}
  <!-- Content -->
  <div class="container mt-5">
    <h1>Reef Live Data</h1>
    <div style="margin: 0 auto; background-color: white;">
      <canvas id="myChart"></canvas>
    </div>
  </div>
  <!-- Footer -->
  {%- include footer.html %}

  {% include scripts/misc.html %}
  <script>
    let myChart; // Variable to store the chart instance

    function fetchDataAndRefreshChart() {
      // Fetch the data from the API endpoint
      fetch('https://reef-controller.duckdns.org/api/messages/Temp')
        .then(response => response.json())
        .then(data => {
          const matrixData = data.matrix;

          // Create a line chart using Chart.js
          const ctx = document.getElementById('myChart').getContext('2d');

          // Check if the chart instance exists and destroy it
          if (myChart) {
            myChart.destroy();
          }

          myChart = new Chart(ctx, {
            type: 'line',
            data: {
              // Your chart data configuration here
            },
            options: {
              responsive: true,
              scales: {
                x: {
                  title: {
                    display: true,
                    text: 'Time (hours)'
                  },
                  ticks: {
                    maxRotation: 0,
                    autoSkip: true,
                    maxTicksLimit: 6 // Maximum number of x-axis ticks to display
                  }
                },
                y: {
                  title: {
                    display: true,
                    text: 'pH'
                  },
                  min: 8.0,
                  max: 8.6
                },
                temperature: {
                  position: 'right',
                  title: {
                    display: true,
                    text: 'Temperature'
                  },
                  min: 74,
                  max: 82
                }
              },
              plugins: {
                legend: {
                  display: false // Hide the legend
                },
                title: {
                  display: true,
                  text: 'Current pH',
                  position: 'top',
                  align: 'start',
                  padding: {
                    top: 5,
                    bottom: 10
                  }
                }
              }
            }
          });
        });
    }

    // Fetch data and refresh chart initially
    fetchDataAndRefreshChart();

    // Refresh chart every minute
    setInterval(fetchDataAndRefreshChart, 60000);
  </script>
</body>

</html>
