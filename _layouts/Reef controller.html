<!DOCTYPE html>
<html lang="{{ site.lang }}">

<!-- Head -->

<head>
  {%- if page.redirect -%}
  <meta http-equiv="refresh" content="3; url={{ site.baseurl }}/" />
  {%- endif -%}
  {% include head.html %}
  <title>Reef Live Data</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<!-- Body -->

<body
  class="{% if site.navbar_fixed %}fixed-top-nav{% endif %} {% unless site.footer_fixed %}sticky-bottom-footer{% endunless %}">

  <!-- Header -->
  {%- include header.html %}

  <!-- Content -->
  <div class="container mt-5">
    <h1>Reef Live Data</h1>
    <div style="max-width: 800px; margin: 0 auto; background-color: white;">
      <canvas id="myChart"></canvas>
    </div>
  </div>

  <!-- Footer -->
  {%- include footer.html %}

  <script>
    // Retrieve the response data from the ESP8266 web server
    // Retrieve the response data from the ESP8266 web server
fetch('https://bk-projects.serveo.net/')
  .then(response => response.text())
  .then(data => {
    const response = data.trim();
    const responseArray = response.split(',');

    // Create a line chart using Chart.js
    const ctx = document.getElementById('myChart').getContext('2d');

    // Modify the dataset to include the red vertical line
    const dataset = {
      label: 'pH',
      data: responseArray.map(Number), // Convert responseArray to numbers
      borderColor: 'rgba(120, 224, 143, 1)',
      fill: false,
      pointBackgroundColor: 'rgba(120, 224, 143, 1)', // Seafoam green color for the plotted dot
      spanGaps: true, // Allow drawing a line between NaN values
    };

    const currentTimeIndex = Math.floor(new Date().getHours() * 12 + new Date().getMinutes() / 5);
    dataset.data[currentTimeIndex] = 8.5; // Set the pH value to 8.5 for the current time index

    const chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: Array.from({ length: responseArray.length }, (_, i) => `${Math.floor(i / 12)}:00`), // X-axis labels from 0:00 to 23:55
        datasets: [dataset]
      },
      options: {
        responsive: true,
        scales: {
          x: {
            title: {
              display: true,
              text: 'Time (hours)'
            },
            ticks: {
              stepSize: 12
            }
          },
          y: {
            title: {
              display: true,
              text: 'pH'
            },
            min: 7.9,
            max: 8.5
          }
        }
      }
    });
  });

  </script>
</body>

</html>